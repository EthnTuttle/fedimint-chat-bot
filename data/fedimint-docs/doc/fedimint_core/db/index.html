<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `db` mod in crate `fedimint_core`."><meta name="keywords" content="rust, rustlang, rust-lang, db"><title>fedimint_core::db - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-1f7d512b176f0f72.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-124a1ca42af929b6.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-6827029ac823cab7.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../../static.files/light-ebce58d0a40c3431.css"><link rel="stylesheet" disabled href="../../static.files/dark-f23faae4a2daf9a6.css"><link rel="stylesheet" disabled href="../../static.files/ayu-8af5e100b21cd173.css"><script id="default-settings" ></script><script src="../../static.files/storage-d43fa987303ecbbb.js"></script><script defer src="../../static.files/main-c55e1eb52e1886b4.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../fedimint_core/index.html"><div class="logo-container"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../fedimint_core/index.html"><div class="logo-container"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2 class="location"><a href="#">Module db</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li><li><a href="#types">Type Definitions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Module <a href="../index.html">fedimint_core</a>::<wbr><a class="mod" href="#">db</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../src/fedimint_core/db/mod.rs.html#1-2502">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="mod" href="mem_impl/index.html" title="fedimint_core::db::mem_impl mod">mem_impl</a></div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="notifications/index.html" title="fedimint_core::db::notifications mod">notifications</a></div></div></div><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.CommitTracker.html" title="fedimint_core::db::CommitTracker struct">CommitTracker</a></div><div class="item-right docblock-short">A handle to a type-erased database implementation</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Database.html" title="fedimint_core::db::Database struct">Database</a></div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.DatabaseTransaction.html" title="fedimint_core::db::DatabaseTransaction struct">DatabaseTransaction</a></div><div class="item-right docblock-short"><code>DatabaseTransaction</code> is the parent-level database transaction that can
modify the database. The owner of the <code>DatabaseTransaction</code> is responsible
for managing the lifetime of the <code>DatabaseTransaction</code>, either by committing
the modifications to the database or rolling back the transaction. From this
parent-level <code>DatabaseTransaction</code>, a <code>ModuleDatabaseTransaction</code>
can be created which operates like a child transaction where the child
transaction only has access to the modules database namespace.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.DatabaseVersion.html" title="fedimint_core::db::DatabaseVersion struct">DatabaseVersion</a></div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.DatabaseVersionKey.html" title="fedimint_core::db::DatabaseVersionKey struct">DatabaseVersionKey</a></div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.DbKeyPrefixIter.html" title="fedimint_core::db::DbKeyPrefixIter struct">DbKeyPrefixIter</a></div><div class="item-right docblock-short">An iterator over the variants of <a href="struct.DbKeyPrefixIter.html" title="Self">Self</a></div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ModuleDatabaseTransaction.html" title="fedimint_core::db::ModuleDatabaseTransaction struct">ModuleDatabaseTransaction</a></div><div class="item-right docblock-short"><code>ModuleDatabaseTransaction</code> is the public wrapper structure that allows
modules to modify the database. It takes a <code>ISingleUseDatabaseTransaction</code>
that handles the details of interacting with the database. The APIs that the
modules are allowed to interact with are a subset of <code>DatabaseTransaction</code>,
since modules do not manage the lifetime of database transactions.
Committing to the database or rolling back a transaction is not exposed.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SingleUseDatabaseTransaction.html" title="fedimint_core::db::SingleUseDatabaseTransaction struct">SingleUseDatabaseTransaction</a></div><div class="item-right docblock-short">Struct that implements <code>ISingleUseDatabaseTransaction</code> and can be wrapped
easier in other structs since it does not consumed <code>self</code> by move.</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.AutocommitError.html" title="fedimint_core::db::AutocommitError enum">AutocommitError</a></div><div class="item-right docblock-short">Error returned when the autocommit function fails</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.DbKeyPrefix.html" title="fedimint_core::db::DbKeyPrefix enum">DbKeyPrefix</a></div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.DecodingError.html" title="fedimint_core::db::DecodingError enum">DecodingError</a></div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.TestDbKeyPrefix.html" title="fedimint_core::db::TestDbKeyPrefix enum">TestDbKeyPrefix</a></div></div></div><h2 id="constants" class="small-section-header"><a href="#constants">Constants</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.MODULE_GLOBAL_PREFIX.html" title="fedimint_core::db::MODULE_GLOBAL_PREFIX constant">MODULE_GLOBAL_PREFIX</a></div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.DatabaseKey.html" title="fedimint_core::db::DatabaseKey trait">DatabaseKey</a></div><div class="item-right docblock-short"><code>DatabaseKey</code> that represents the lookup structure for retrieving key/value
pairs from the database.</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.DatabaseKeyPrefix.html" title="fedimint_core::db::DatabaseKeyPrefix trait">DatabaseKeyPrefix</a></div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.DatabaseKeyWithNotify.html" title="fedimint_core::db::DatabaseKeyWithNotify trait">DatabaseKeyWithNotify</a></div><div class="item-right docblock-short">Marker trait for <code>DatabaseKey</code>s where <code>NOTIFY</code> is true</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.DatabaseLookup.html" title="fedimint_core::db::DatabaseLookup trait">DatabaseLookup</a></div><div class="item-right docblock-short">A key that can be used to query one or more <code>DatabaseRecord</code>
Extends <code>DatabaseKeyPrefix</code> to prepend the key’s prefix.</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.DatabaseRecord.html" title="fedimint_core::db::DatabaseRecord trait">DatabaseRecord</a></div><div class="item-right docblock-short">A key + value pair in the database with a unique prefix
Extends <code>DatabaseKeyPrefix</code> to prepend the key’s prefix.</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.DatabaseValue.html" title="fedimint_core::db::DatabaseValue trait">DatabaseValue</a></div><div class="item-right docblock-short"><code>DatabaseValue</code> that represents the value structure of database records.</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.IDatabase.html" title="fedimint_core::db::IDatabase trait">IDatabase</a></div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.IDatabaseTransaction.html" title="fedimint_core::db::IDatabaseTransaction trait">IDatabaseTransaction</a></div><div class="item-right docblock-short">Fedimint requires that the database implementation implement Snapshot
Isolation. Snapshot Isolation is a database isolation level that guarantees
consistent reads from the time that the snapshot was created (at transaction
creation time). Transactions with Snapshot Isolation level will only commit
if there has been no write to the modified keys since the snapshot (i.e.
write-write conflicts are prevented).</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.ISingleUseDatabaseTransaction.html" title="fedimint_core::db::ISingleUseDatabaseTransaction trait">ISingleUseDatabaseTransaction</a></div><div class="item-right docblock-short"><code>ISingleUseDatabaseTransaction</code> re-defines the functions from
<code>IDatabaseTransaction</code> but does not consumed <code>self</code> when committing to the
database. This allows for wrapper structs to more easily borrow
<code>ISingleUseDatabaseTransaction</code> without needing to make additional
allocations.</div></div></div><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.apply_migrations.html" title="fedimint_core::db::apply_migrations fn">apply_migrations</a></div><div class="item-right docblock-short"><code>apply_migrations</code> iterates from the on disk database version for the module
up to <code>target_db_version</code> and executes all of the migrations that exist in
the <code>MigrationMap</code>. Each migration in <code>MigrationMap</code> updates the database to
have the correct on-disk structures that the code is expecting. The entire
migration process is atomic (i.e migration from 0-&gt;1 and 1-&gt;2 happen
atomically). This function is called before the module is initialized and as
long as the correct migrations are supplied in <code>MigrationMap</code>, the module
will be able to read and write from the database successfully.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.expect_write_conflict.html" title="fedimint_core::db::expect_write_conflict fn">expect_write_conflict</a></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.find_by_prefix_sorted_descending.html" title="fedimint_core::db::find_by_prefix_sorted_descending fn">find_by_prefix_sorted_descending</a></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.future_returns_shortly.html" title="fedimint_core::db::future_returns_shortly fn">future_returns_shortly</a></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.verify_commit.html" title="fedimint_core::db::verify_commit fn">verify_commit</a></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.verify_find_by_prefix.html" title="fedimint_core::db::verify_find_by_prefix fn">verify_find_by_prefix</a></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.verify_insert_elements.html" title="fedimint_core::db::verify_insert_elements fn">verify_insert_elements</a></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.verify_module_db.html" title="fedimint_core::db::verify_module_db fn">verify_module_db</a></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.verify_module_prefix.html" title="fedimint_core::db::verify_module_prefix fn">verify_module_prefix</a></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.verify_phantom_entry.html" title="fedimint_core::db::verify_phantom_entry fn">verify_phantom_entry</a></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.verify_prevent_dirty_reads.html" title="fedimint_core::db::verify_prevent_dirty_reads fn">verify_prevent_dirty_reads</a></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.verify_prevent_nonrepeatable_reads.html" title="fedimint_core::db::verify_prevent_nonrepeatable_reads fn">verify_prevent_nonrepeatable_reads</a></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.verify_read_own_writes.html" title="fedimint_core::db::verify_read_own_writes fn">verify_read_own_writes</a></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.verify_remove_by_prefix.html" title="fedimint_core::db::verify_remove_by_prefix fn">verify_remove_by_prefix</a></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.verify_remove_existing.html" title="fedimint_core::db::verify_remove_existing fn">verify_remove_existing</a></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.verify_remove_nonexisting.html" title="fedimint_core::db::verify_remove_nonexisting fn">verify_remove_nonexisting</a></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.verify_rollback_to_savepoint.html" title="fedimint_core::db::verify_rollback_to_savepoint fn">verify_rollback_to_savepoint</a></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.verify_string_prefix.html" title="fedimint_core::db::verify_string_prefix fn">verify_string_prefix</a></div></div></div><h2 id="types" class="small-section-header"><a href="#types">Type Definitions</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="type" href="type.MigrationMap.html" title="fedimint_core::db::MigrationMap type">MigrationMap</a></div><div class="item-right docblock-short">MigrationMap is a BTreeMap that maps DatabaseVersions to async functions.
These functions are expected to “migrate” the database from the keyed
DatabaseVersion to DatabaseVersion + 1.</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.PrefixStream.html" title="fedimint_core::db::PrefixStream type">PrefixStream</a></div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="fedimint_core" data-themes="" data-resource-suffix="" data-rustdoc-version="1.67.0 (fc594f156 2023-01-24)" data-search-js="search-444266647c4dba98.js" data-settings-js="settings-bebeae96e00e4617.js" data-settings-css="settings-af96d9e2fc13e081.css" ></div></body></html>