logo [../../static.files/rust-logo-151179464ae7ed46.svg]../../fedimintd/index.html
? [../../help.html]
Change settings [../../static.files/wheel-5ec35bf9ca753509.svg]../../settings.html

1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89


use bitcoin::Network;
use fedimint_core::bitcoinrpc::BitcoinRpcConfig;
use fedimint_core::config::ServerModuleGenParamsRegistry;
use fedimint_core::core::{
    LEGACY_HARDCODED_INSTANCE_ID_LN, LEGACY_HARDCODED_INSTANCE_ID_MINT,
    LEGACY_HARDCODED_INSTANCE_ID_WALLET,
};
use fedimint_core::module::ServerModuleGen;
use fedimint_core::{Amount, Tiered};
use fedimint_ln_server::common::config::{
    LightningGenParams, LightningGenParamsConsensus, LightningGenParamsLocal,
};
use fedimint_ln_server::LightningGen;
use fedimint_mint_server::common::config::{MintGenParams, MintGenParamsConsensus};
use fedimint_mint_server::MintGen;
use fedimint_wallet_server::common::config::{
    WalletGenParams, WalletGenParamsConsensus, WalletGenParamsLocal,
};
use fedimint_wallet_server::WalletGen;
use url::Url;

/// Module for creating `fedimintd` binary with custom modules
pub mod fedimintd;

/// Generates the configuration for the modules configured in the server binary
pub fn attach_default_module_gen_params(
    bitcoin_rpc: BitcoinRpcConfig,
    module_gen_params: &mut ServerModuleGenParamsRegistry,
    max_denomination: Amount,
    network: Network,
    finality_delay: u32,
) {
    module_gen_params
        .attach_config_gen_params(
            LEGACY_HARDCODED_INSTANCE_ID_WALLET,
            WalletGen::kind(),
            WalletGenParams {
                local: WalletGenParamsLocal {
                    bitcoin_rpc: bitcoin_rpc.clone(),
                },
                consensus: WalletGenParamsConsensus {
                    network,
                    // TODO this is not very elegant, but I'm planning to get rid of it in a next
                    // commit anyway
                    finality_delay,
                    client_default_bitcoin_rpc: default_esplora_server(network),
                },
            },
        )
        .attach_config_gen_params(
            LEGACY_HARDCODED_INSTANCE_ID_MINT,
            MintGen::kind(),
            MintGenParams {
                local: Default::default(),
                consensus: MintGenParamsConsensus {
                    mint_amounts: Tiered::gen_denominations(max_denomination)
                        .tiers()
                        .cloned()
                        .collect(),
                },
            },
        )
        .attach_config_gen_params(
            LEGACY_HARDCODED_INSTANCE_ID_LN,
            LightningGen::kind(),
            LightningGenParams {
                local: LightningGenParamsLocal { bitcoin_rpc },
                consensus: LightningGenParamsConsensus { network },
            },
        );
}

pub fn default_esplora_server(network: Network) -> BitcoinRpcConfig {
    let url = match network {
        Network::Bitcoin => Url::parse("https://blockstream.info/api/")
            .expect("Failed to parse default esplora server"),
        Network::Testnet => Url::parse("https://blockstream.info/testnet/api/")
            .expect("Failed to parse default esplora server"),
        Network::Regtest => {
            Url::parse("http://127.0.0.1:50002/").expect("Failed to parse default esplora server")
        }
        Network::Signet => Url::parse("https://mutinynet.com/api/")
            .expect("Failed to parse default esplora server"),
    };
    BitcoinRpcConfig {
        kind: "esplora".to_string(),
        url,
    }
}


